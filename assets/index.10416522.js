var e=Object.defineProperty,t=Object.assign,n=(t,n,o)=>("symbol"!=typeof n&&(n+=""),n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o);import{v as o,n as r,o as s,a,r as i,O as l,m as c,i as u,l as d,u as m,t as p,S as h,E as f,b as y,R as b,c as g,d as v,P as E,e as w,f as k,B as x,g as C,M as S,h as M,j as T,H as I,k as N,p as K,q as D,s as O,w as _}from"./vendor.a875edc9.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,s)=>{const a=new URL(e,o);if(self[t].moduleMap[a])return n(self[t].moduleMap[a]);const i=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(i),onerror(){s(new Error(`Failed to import: ${e}`)),r(l)},onload(){n(self[t].moduleMap[a]),r(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/WebMIDICon/assets/");const F=s({status:"Initializing MIDI system",outputs:[],selectedOutputKey:null,requiresNewWindow:!1});const B=a("selectOutput",(e=>{const t=window.midiAccess;if(!t)return;const n=e&&t.outputs.get(e);if(!n)return window.alert("No output key "+e+" found");window.midiOutput=n,L("Using output: "+n.name)})),L=a("setStatus",(e=>{F.status=e})),R=a("requireNewWindow",(()=>{F.status="MIDI not available in CodeSandbox preview, please Open in New Window",F.requiresNewWindow=!0})),A=a("handleAvailableOutputs",(e=>{F.outputs=e;for(const t of e)if(F.selectedOutputKey===t.key)return;F.selectedOutputKey||(e.length?F.selectedOutputKey=e[0].key:F.selectedOutputKey=null)}));function z(e){window.midiAccess=e,L("Found MIDI outputs: "+e.outputs.size);try{W(e)}catch(t){L("Cannot access MIDI output "+t)}}function W(e){const t=[],n=e.outputs.keys();for(;;){const{done:o,value:r}=n.next();if(o)break;t.push({key:r,name:e.outputs.get(r).name})}const o=F.selectedOutputKey;A(t),o!==F.selectedOutputKey&&B(F.selectedOutputKey)}function j(e){window.midiOutput&&window.midiOutput.send(e)}setTimeout((function(){if(window.midiAccess)return L("MIDI saved!!"),void z(window.midiAccess);navigator.requestMIDIAccess?(L("Requesting MIDI access"),navigator.requestMIDIAccess({sysex:!1}).then((e=>{z(e),e.onstatechange=()=>function(e){W(e)}(e)}),(e=>{String(e).match(/^SecurityError:/)&&window.location.hostname.match(/\.codesandbox\.io$/)?R():L("Failed to request MIDI access! "+e)}))):"undefined"!=typeof webkit&&webkit.messageHandlers&&webkit.messageHandlers.send&&webkit.messageHandlers.send.postMessage?z(function(e){const t={outputs:new Map};return t.outputs.set("bluetooth",{name:"Bluetooth",send:t=>e.postMessage(t.join(";"))}),t}(webkit.messageHandlers.send)):L("MIDI not supported")}));class P extends i.Component{render(){return i.createElement("div",{style:{position:"absolute",top:0,right:0,bottom:0,left:0,display:"flex",alignItems:"center"}},i.createElement("a",{ref:this.props.innerRef,href:"#/",style:{color:"#8b8685",display:"block",marginLeft:10,textDecoration:"none"}},"←"),i.createElement(l,null,(()=>i.createElement(i.Fragment,null,i.createElement(V,null,"Transpose"),this.renderTransposeButton(-6),this.renderTransposeButton(-5),this.renderTransposeButton(-4),this.renderTransposeButton(-3),this.renderTransposeButton(-2),this.renderTransposeButton(-1),this.renderTransposeButton(0),this.renderTransposeButton(1),this.renderTransposeButton(2),this.renderTransposeButton(3),this.renderTransposeButton(4),this.renderTransposeButton(5),this.renderTransposeButton(6)))),i.createElement(l,null,(()=>i.createElement(i.Fragment,null,i.createElement(V,null,"Octave"),this.renderOctaveButton(0),this.renderOctaveButton(1),this.renderOctaveButton(2),this.renderOctaveButton(3),this.renderOctaveButton(4),this.renderOctaveButton(5),this.renderOctaveButton(6)))))}renderTransposeButton(e){const t=this.props.store;return i.createElement($,{width:"1.3em",onTap:()=>t.setTranspose(e),selected:t.transpose===e},e)}renderOctaveButton(e){const t=this.props.store;return i.createElement($,{width:"1.2em",onTap:()=>t.setOctave(e),selected:t.octave===e},e)}}const V=e=>i.createElement("div",{style:{marginLeft:12,fontWeight:"bold",fontSize:"0.8em",textTransform:"uppercase",color:"#8b8685"}},e.children),$=e=>i.createElement("div",{onTouchStart:t=>{t.preventDefault(),e.onTap()},style:{marginLeft:6,background:e.selected?"#656463":"#090807",color:e.selected?"#e9e8e7":"#8b8685",padding:"3px 4px",borderRadius:4,width:e.width||"auto",display:"inline-block",textAlign:"center"}},e.children),U=c();function q({text:e}){return i.createElement("span",{dangerouslySetInnerHTML:(t=e,{__html:U.renderInline(t)})});var t}const H=e=>["instruments","addons"].indexOf(e)+1||Number.MAX_VALUE;function G({features:e}){const t=d.orderBy([...new Set(e.map((e=>e.category)).filter((e=>e)))],[H,e=>e],["asc","asc"]),n=d.groupBy(e,"category");return i.createElement(X,null,i.createElement("h2",null,"Feature list"),i.createElement(Y,null,i.createElement("thead",null,i.createElement("tr",null,i.createElement(J,null,"Feature name"),i.createElement(J,null,"Description"))),i.createElement("tbody",null,t.map((e=>i.createElement(i.Fragment,{key:e},i.createElement("tr",null,i.createElement(Q,{colSpan:2},e)),n[e].map((e=>i.createElement("tr",{key:e.name},i.createElement(ee,null,i.createElement("strong",null,e.name)),i.createElement(te,null,i.createElement(q,{text:e.description})))))))))))}const X=u("div")`
  padding: 0 4vw 4vw;
  max-width: 960px;
  margin: 0 auto;
  > h2 {
    margin: 0 0 0.5em;
    color: #d7fc70;
  }
`,Y=u("table")`
  border-collapse: collapse;
  background: #252423;
  border: 2px solid #656463;
  box-shadow: 4px 4px 0 #090807;
`,J=u("th")`
  border: 1px solid #656463;
  background: #656463;
  padding: 0.25em;
`,Z=u("td")`
  border: 1px solid #656463;
  padding: 0.4em;
`,Q=u(Z)`
  background: #454443;
  text-align: center;
`,ee=u(Z)`
  white-space: nowrap;
  vertical-align: top;
`,te=u(Z)`
  a {
    color: #ffb;
  }
`;class ne extends i.Component{componentDidMount(){this.listener=e=>{e.preventDefault()},this.el.addEventListener("touchstart",this.listener,{passive:!1}),this.el.addEventListener("touchmove",this.listener,{passive:!1}),this.el.addEventListener("touchend",this.listener,{passive:!1})}render(){return i.createElement("div",{ref:e=>this.el=e},this.props.children)}}function oe(e){const t=i.useRef(0),n=i.useRef(null),{registerWheelListener:o,store:r}=e,s=m((()=>e.store.noteVelocity)),a=i.useCallback((e=>{t.current+=e;let n=0;var o,s,a;Math.abs(t.current)>=1&&(n=Math.floor(Math.abs(t.current))*Math.sign(t.current),t.current-=n),0!==n&&(r.noteVelocity=(o=r.noteVelocity+n,s=0,a=127,Math.max(s,Math.min(a,o))))}),[r]);i.useEffect((()=>o((e=>{a(e.deltaX/16)}))),[o,a]);const l=i.useRef({}),c=e=>{const t=l.current,o=new Set;for(const r of Array.from(e.touches)){const e=r.identifier;if(o.add(e),null==t[e])t[e]={x:r.clientX,id:e};else if(n.current){const o=(r.clientX-t[e].x)/n.current.offsetWidth;a(127*o),t[e].x=r.clientX}}for(const n of Object.values(t))o.has(n.id)||delete t[n.id]};return i.createElement(ne,null,i.createElement("div",{className:p`flex absolute inset-0`,onTouchStart:c,onTouchMove:c,onTouchEnd:c},i.createElement("div",{className:p`mx-4 font-bold text-sm uppercase self-center text-#8b8685`},"Velocity (",s,")"),i.createElement("div",{style:{flex:1},ref:n},i.createElement("div",{style:{height:"100%",background:"#555",width:100*s/127+"%"}}))))}const re=i.createContext(null);function se(e,t,n){return e.getValue(n,t.get(n))}function ae(e){const{schema:t,storage:n}=function(){const e=i.useContext(re);if(!e)throw new Error("No context");return e}(),[o,r]=i.useState((()=>se(t,n,e))),[s,a]=i.useState((()=>n.has(e)));return i.useEffect((()=>{const o=n.watch(e,(()=>{r(se(t,n,e)),a(n.has(e))}));return()=>o.unsubscribe()}),[e,n]),{value:o,overridden:s,setValue:o=>{!function(e,t,n,o){t.set(n,e.serialize(n,o))}(t,n,e,o)},resetValue:()=>{n.delete(e)}}}const ie=[{name:"Ride Edge / Chinese Cymbal",note:52},{name:"Ride Bell",note:53},{name:"Crash Cymbal 1",note:57},{name:"Crash Cymbal 2",note:49},{name:"Hi-Mid Tom",note:48},{name:"Low Tom",note:45},{name:"Low Floor Tom",note:41},{name:"Ride In",note:59},{name:"Kick",note:36},{name:"Acoustic Snare",note:38},{name:"Closed Hi-Hat",note:42},{name:"Open Hi-Hat",note:46},{name:"Kick",note:36},{name:"Sidestick",note:37},{name:"Kick",note:36},{name:"Kick",note:36}];function le(){const e=ae("drumPad.buttonOverride").value||"";return i.useMemo((()=>{const t=[...ie];return e.replace(/(\d+)\s*=\s*(\d+)\s*,\s*([^;]+)/g,((e,n,o,r)=>{const s=+n-1,a=+o;return s>=0&&s<t.length&&a>0&&a<128&&(t[s]={name:r,note:a}),""})),t}),[ie,e])}const ce=e=>{const t=le();return i.createElement(i.Fragment,null,e.children(t))};function ue(){const e=i.useContext(re);if(!e)throw new Error("No context");const{schema:t}=e,n=e=>e.stopPropagation();return i.createElement("div",{className:p`p-4`,onKeyDown:n,onKeyUp:n},i.createElement("h2",{className:p`text-3xl p-2 text-#8b8685 font-bold`},"WebMIDICon configuration"),t.sections.map(((e,t)=>i.createElement("section",{key:t,className:p`mb-8`},i.createElement("h2",{className:p`text-2xl pt-2 px-2 text-#d7fc70`},e.title),Object.entries(e.properties).map((([e,t])=>i.createElement("div",{className:p`p-2 leading-normal`,key:e},i.createElement("h3",{className:p`font-bold`},i.createElement(de,{propertyName:e})),i.createElement(pe,{propertyName:e,propertyDescriptor:t,description:t.markdownDescription?i.createElement("div",{className:p`opacity-75`},i.createElement(q,{text:t.markdownDescription})):null}))))))),i.createElement("section",{key:"section-config-drumpad-mapping",className:p`mb-8`},i.createElement("h2",{className:p`text-2xl pt-2 px-2 text-#d7fc70`},"Drumpad Mapping"),i.createElement("div",{className:p`p-2 leading-normal`,key:"config-drumpad-mapping"},i.createElement("h3",{className:p`font-bold`},i.createElement(de,{propertyName:"drumPad.keymap"})),i.createElement(me,null))))}function de({propertyName:e}){return i.createElement("span",null,e.split(".").slice(1).map(((e,t,n)=>{const o=t===n.length-1;return i.createElement("span",{key:t,className:o?p`text-white`:""},e.replace(/([A-Z])/g," $1").replace(/\w/,(e=>e.toUpperCase())),o?"":": ")})))}function me(){const{value:e,overridden:t,setValue:n,resetValue:o}=ae("drumPad.buttonOverride"),r=i.createElement("span",{className:p`ml-2 text-#8b8685`},"(default:"," ",i.createElement("button",{className:p`underline`,title:"Click to reset to default value",onClick:o},"Reset"),")"),s=e=>{var t,o;console.log("selectedOption: ",e),t=e.index+1,o=e.value,a[t]=`${t}=${o}`,n(a.join(""))},a=[],l=[];let c=[];return le().forEach(((e,t)=>{a[t+1]=`${t+1}=${e.note},${e.name};`,c.push(i.createElement("div",{style:{color:"black",width:"100%"},key:`mapbutton${t}`},i.createElement(h,{className:p`p-1 bg-#090807 border border-#656463`,onChange:s,value:{label:e.name,value:`${e.note},${e.name};`},options:[{name:"Select Notes",note:0},...[{name:"Acoustic Bass Drum",note:35},{name:"Kick",note:36},{name:"Sidestick",note:37},{name:"Acoustic Snare",note:38},{name:"Hand Clap",note:39},{name:"Electric Snare",note:40},{name:"Low Floor Tom",note:41},{name:"Closed Hi-Hat",note:42},{name:"High Floor Tom",note:43},{name:"Pedal Hi-Hat",note:44},{name:"Low Tom",note:45},{name:"Open Hi-Hat",note:46},{name:"Low-Mid Tom",note:47},{name:"Hi-Mid Tom",note:48},{name:"Crash Cymbal 2",note:49},{name:"High Tom",note:50},{name:"Ride Cymbal 1",note:51},{name:"Ride Edge / Chinese Cymbal",note:52},{name:"Ride Bell",note:53},{name:"Tambourine",note:54},{name:"Splash Cymbal",note:55},{name:"Cowbell",note:56},{name:"Crash Cymbal 1",note:57},{name:"Vibraslap",note:58},{name:"Ride In",note:59},{name:"Hi Bongo",note:60},{name:"Low Bongo",note:61},{name:"Mute Hi Conga",note:62},{name:"Open Hi Conga",note:63},{name:"Low Conga",note:64},{name:"High Timbale",note:65},{name:"Low Timbale",note:66},{name:"High Agogo",note:67},{name:"Low Agogo",note:68},{name:"Cabasa",note:69},{name:"Maracas",note:70},{name:"Short Whistle",note:71},{name:"Long Whistle",note:72},{name:"Short Guiro",note:73},{name:"Long Guiro",note:74},{name:"Claves",note:75},{name:"Hi Wood Block",note:76},{name:"Low Wood Block",note:77},{name:"Mute Cuica",note:78},{name:"Open Cuica",note:79},{name:"Mute Triangle",note:80},{name:"Open Triangle",note:81}].sort(((e,t)=>e.name>t.name?1:t.name>e.name?-1:0))].map((e=>({value:`${e.note},${e.name};`,label:e.name,index:t})))})))})),l.push(i.createElement("div",{className:p`grid grid-cols-4 gap-4`,style:{width:"max-content"}},c)),i.createElement("div",{style:{overflowX:"scroll",whiteSpace:"nowrap"}},[r,l])}function pe(e){const{value:t,overridden:n,setValue:o,resetValue:r}=ae(e.propertyName),s=n?i.createElement("span",{className:p`ml-2 text-#8b8685`},"(default:"," ",i.createElement("button",{className:p`underline`,title:"Click to reset to default value",onClick:r},e.propertyDescriptor.default),")"):null;return"boolean"===e.propertyDescriptor.type?i.createElement("div",{className:p`flex`},i.createElement("input",{type:"checkbox",className:p`mr-2`}),e.description):"string"===e.propertyDescriptor.type&&e.propertyDescriptor.enum?i.createElement(i.Fragment,null,e.description,i.createElement("p",null,i.createElement("select",{className:p`p-1 bg-#090807 border border-#656463`,onChange:e=>o(e.target.value),value:t},e.propertyDescriptor.enum.map((e=>i.createElement("option",{key:e,value:e},e)))),s)):"string"===e.propertyDescriptor.type?i.createElement(i.Fragment,null,e.description,i.createElement("p",null,i.createElement(he,{value:t,onChange:e=>{o(e)}}),n?i.createElement("span",{className:p`ml-2 text-#8b8685`},"(default:"," ",i.createElement("button",{className:p`underline`,title:"Click to reset to default value",onClick:r},e.propertyDescriptor.default),")"):null)):i.createElement(i.Fragment,null,e.description)}function he(e){const[t,n]=i.useState(e.value),[o,r]=i.useState(e.value);return o!==e.value&&(r(e.value),n(e.value)),i.createElement("input",{type:"text",className:p`p-1 bg-#090807 border border-#656463`,value:t,onChange:t=>{n(t.target.value),e.onChange(t.target.value)}})}const fe=s.map({},{deep:!1});function ye(){return i.createElement("div",{className:p`flex flex-auto text-sm text-#8b8685`},i.createElement(l,null,(()=>i.createElement(i.Fragment,null,[...fe].map((([e,t])=>i.createElement(be,{key:e},t)))))),i.createElement("div",{className:p`flex-auto`}),i.createElement(be,null,"WebMIDICon"))}function be(e){return i.createElement("div",{className:p`px-2 flex items-center`},i.createElement("div",null,e.children))}function ge(e){return i.useEffect((()=>(fe.set(e.id,e.children),()=>{fe.delete(e.id)})),[e.id,e.children]),null}function ve(e){return i.createElement(i.Fragment,null,e.features.map(((t,n)=>{const o=t.serviceComponent;return o?i.createElement(f,{key:`errorBoundary${n}`,fallbackRender:({error:e,resetErrorBoundary:n})=>i.createElement(Ee,{thing:t.name,error:e,onReset:n})},i.createElement(o,{key:n,store:e.store})):null})))}function Ee(e){const{thing:t,onReset:n,error:o}=e;return i.createElement(ge,{id:"error_"+t},i.createElement("button",{onClick:()=>{confirm(`${t} service failed: ${o&&o.stack||o}\n\nRestart this component?`)&&n()},className:p`cursor-pointer text-[#ffaaaa]`},t," service failed"))}function we(e){const t=i.useRef(e);i.useLayoutEffect((()=>{t.current=e}),[e]);const{value:n}=ae("midi.output.channel"),o=+n||1,r=i.useRef(o);i.useLayoutEffect((()=>{r.current=o}),[o]);const[s]=i.useState((()=>function(e){const t=new Map;return{handleNotes(n){for(const o of n)if(!t.has(o)){const n=o+e.getTranspose()+12*e.getOctave(),r=e.getVelocity(),s=e.getChannel();j([144+s-1,n,r]);const a={off:()=>{j([128+s-1,n,r])}};t.set(o,a)}for(const e of t.keys())if(!n.has(e)){const n=t.get(e);null==n||n.off(),t.delete(e)}}}}({getTranspose:()=>t.current.transpose,getOctave:()=>t.current.octave,getVelocity:()=>t.current.velocity,getChannel:()=>r.current})));return i.useLayoutEffect((()=>{s.handleNotes(e.activeNotes)}),[e.activeNotes]),null}class ke extends i.Component{constructor(e){super(e),n(this,"handleGlobalKeyDown",(e=>{13===e.keyCode&&this.contentElement&&this.contentElement.focus()})),n(this,"handleKeyDown",(e=>{if(e.metaKey&&e.keyCode>=48&&e.keyCode<=57)return j([192,48===e.keyCode?9:e.keyCode-49]),void e.preventDefault();e.metaKey||e.ctrlKey||(e.stopPropagation(),27!==e.keyCode?(this.store.handleKeyDown(e.nativeEvent),e.preventDefault()):this.toolbarElement&&this.toolbarElement.focus())})),n(this,"handleKeyUp",(e=>{e.stopPropagation(),this.store.handleKeyUp(e.nativeEvent),e.preventDefault()})),n(this,"wheelListeners",new Set),n(this,"registerWheelListener",(e=>{const t=this.wheelListeners;return t.add(e),()=>t.delete(e)})),n(this,"handleWheel",(e=>{var t;if(!(null==(t=e.target)?void 0:t.closest("[data-scroll-view]"))&&document.activeElement===this.contentElement){e.preventDefault();for(const t of this.wheelListeners)t(e)}})),n(this,"handleClick",(e=>{setTimeout((()=>{this.contentElement&&(document.activeElement&&this.contentElement.contains(document.activeElement)||this.contentElement.focus())}))}));const{features:t,store:o}=e;this.store=o;const r=d.sortBy([].concat(...t.map((e=>e.instruments||[]))),"sortKey");console.log("Loaded instruments:",r),this.instruments=r}componentDidMount(){window.addEventListener("keydown",this.handleGlobalKeyDown,!1),window.addEventListener("wheel",this.handleWheel,{passive:!1})}UNSAFE_componentWillUnmount(){window.removeEventListener("keydown",this.handleGlobalKeyDown,!1),window.removeEventListener("wheel",this.handleWheel,{passive:!1})}renderContent(){return i.createElement(y,null,this.instruments.map((e=>{const t=e.component;return i.createElement(b,{key:e.id,path:`/${e.id}`,component:()=>i.createElement(t,{store:this.store})})})).concat([i.createElement(b,{key:"@@configuration",path:"/config",render:()=>this.renderConfiguration()}),i.createElement(b,{key:"@@main",render:()=>this.renderMainMenu()})]))}renderMainMenu(){return i.createElement(Ke,null,i.createElement(l,null,(()=>i.createElement(i.Fragment,null,F.requiresNewWindow&&i.createElement(De,null)))),i.createElement(Me,null,this.instruments.map((e=>i.createElement(i.Fragment,{key:e.id},this.renderMenuItem(`#/${e.id}`,e.name,e.description))))),i.createElement(G,{features:this.props.features}))}renderConfiguration(){return i.createElement(Ke,null,i.createElement(ue,null))}renderMenuItem(e,t,n){return i.createElement(Te,null,i.createElement(Ie,{href:e},i.createElement("h2",null,t),i.createElement("p",null,n)))}render(){return i.createElement("div",null,i.createElement(xe,null,i.createElement(P,{store:this.store,innerRef:e=>this.toolbarElement=e})),i.createElement(Ce,{tabIndex:0,onClick:this.handleClick,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,innerRef:e=>this.contentElement=e},this.renderContent()),i.createElement(Se,null,i.createElement(oe,{store:this.store,registerWheelListener:this.registerWheelListener})),i.createElement("section",{className:p`absolute bottom-0 inset-x-0 h-[24px] flex bg-#252423 border-t border-#454443`},i.createElement(ye,null)),i.createElement(l,null,(()=>i.createElement(we,{activeNotes:this.store.activeNotes,transpose:this.store.transpose,octave:this.store.octave,velocity:this.store.noteVelocity}))),i.createElement(ve,{features:this.props.features,store:this.store}))}}const xe=u("div")`
  position: absolute;
  top: 0;
  right: 0;
  height: 40px;
  left: 0;
`,Ce=u("div")`
  position: absolute;
  top: 40px;
  right: 0;
  bottom: 54px;
  left: 0;
  &:focus {
    outline: none;
    box-shadow: inset 0 0 0 2px #656463;
  }
`,Se=u("div")`
  position: absolute;
  height: 30px;
  right: 0;
  bottom: 24px;
  left: 0;
`,Me=u("ul")`
  font-size: 2vw;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  padding: 0;
  list-style: none;
`,Te=u("li")`
  flex-basis: 48%;
  display: flex;
  flex-direction: column;
`,Ie=u("a")`
  flex: 1;
  color: #e9e8e7;
  display: block;
  background: #252423;
  margin: 0.5em;
  padding: 0.5em;
  border: 2px solid #555453;
  text-align: left;
  text-decoration: none;
  box-shadow: 4px 4px 0 #090807;
  &:hover {
    transform: scale(1.025);
  }
  & > h2 {
    margin: 0;
    font-size: 1.5em;
    color: #bef;
  }
  & > p {
    margin: 0.5em 0 0;
  }
`,Ne=u("div")`
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
`;function Ke({children:e}){return i.createElement(Ne,{"data-scroll-view":"1"},e)}function De(){return i.createElement("div",{style:{margin:"1em auto",width:"96%"}},i.createElement(Oe,null,i.createElement("strong",null,"MIDI is not available in CodeSandbox Preview."),i.createElement("br",null),"Please click “Open in New Window” button to use this app."))}const Oe=u("a")`
  display: block;
  margin: 0.5em;
  padding: 0.5em;
  background: #422;
  border: 2px solid #c66;
  color: #e9e8e7;
  text-decoration: none;
  box-shadow: 4px 4px 0 #090807;
`,_e={midi:{title:"MIDI",properties:{"midi.output.channel":{type:"string",default:"1",markdownDescription:"The MIDI output channel to use."}}}};function Fe({features:e,children:t}){const n=i.useMemo((()=>{const e={},t=t=>{const n=e[t];if(n)for(const e of n)e()};return{get:e=>localStorage["WebMIDICon_"+e],has:e=>void 0!==localStorage["WebMIDICon_"+e],delete(e){delete localStorage["WebMIDICon_"+e],t(e)},set(e,n){localStorage["WebMIDICon_"+e]=n,t(e)},watch(t,n){var o;const r=null!=(o=e[t])?o:e[t]=new Set,s=()=>n();return r.add(s),{unsubscribe:()=>{r.delete(s)}}}}}),[]),o=i.useMemo((()=>{const t={},n=[...Object.values(_e),...e.flatMap((e=>e.configuration?[e.configuration]:[]))];for(const e of n)for(const[n,o]of Object.entries(e.properties))t[n]=o;return{getValue(e,n){const o=t[e];return"string"===o.type?null!=n?n:o.default:"boolean"===o.type?"true"===n||"false"!==n&&o.default:void 0},getDefaultValue(e){const n=t[e];return null==n?void 0:n.default},serialize(e,n){const o=t[e];return"string"===o.type?n:"boolean"===o.type?n?"true":"false":""},sections:n}}),[e]);return i.createElement(re.Provider,{value:{schema:o,storage:n}},t)}const Be=i.createContext(null);function Le({features:e,children:t}){const[n]=i.useState((()=>function(e){const t=e.map((e=>e.onKeyDown)).filter((e=>e)),n=e.map((e=>e.onKeyUp)).filter((e=>e)),o=e.map((e=>e.getActiveNotes)).filter((e=>e)),r=s({touches:[],transpose:0,octave:3,noteVelocity:+sessionStorage.WEBMIDICON_VELOCITY||96,setTranspose:a("setTranspose",(e=>{let t=r.octave;for(;e>6;)e-=12,t+=1;for(;e<-6;)e+=12,t-=1;r.transpose=e,t!==r.octave&&r.setOctave(t)})),setOctave:a("setOctave",(e=>{r.octave=e})),handleTouches:a("updateTouches",(e=>{r.touches=e})),handleKeyDown:a("handleKeyDown",(e=>{t.forEach((t=>t(r,e)))})),handleKeyUp:a("handleKeyUp",(e=>{n.forEach((t=>t(r,e)))})),get activeNotes(){const e=new Set;for(const t of r.touches)e.add(t);return o.forEach((t=>{for(const n of t())e.add(n)})),e}});return g((()=>r.noteVelocity),(e=>{sessionStorage.WEBMIDICON_VELOCITY=e})),r}(e)));return i.createElement(Be.Provider,{value:n},t)}function Re(){const e=v({gutter:4,placement:"bottom-end"});return i.createElement(i.Fragment,null,i.createElement(E,t(t({},e),{className:p`text-#8b8685 px-2`}),i.createElement(ze,null)),i.createElement(w,t(t({},e),{"aria-label":"MIDI settings"}),i.createElement("div",{className:p`w-[256px] bg-#090807 border border-#8b8685 p-2`},i.createElement(Ae,{onClose:()=>e.hide()}))))}function Ae(e){let t=k();return i.createElement(i.Fragment,null,i.createElement("div",{className:p`text-#8b8685`},"MIDI output port"),i.createElement(We,null),i.createElement("footer",{className:p`text-right mt-2 text-sm text-#8b8685`},i.createElement(x,{onClick:()=>{t.push("/config"),e.onClose()}},"More configuration settings →")))}function ze(){return i.createElement("svg",{width:24,height:24,viewBox:"0 0 402 403",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M201 402.183c110.838 0 200.69-89.851 200.69-200.689S311.838.804 201 .804.31 90.656.31 201.494 90.162 402.183 201 402.183zm0-26.184c96.377 0 174.505-78.129 174.505-174.505 0-83.859-59.15-153.902-138.005-170.683V62c0 12.15-9.85 22-22 22h-29c-12.15 0-22-9.85-22-22V30.811C85.645 47.592 26.494 117.635 26.494 201.494c0 96.376 78.129 174.505 174.506 174.505zM72.975 226.912c14.038 0 25.418-11.38 25.418-25.418 0-14.039-11.38-25.419-25.418-25.419-14.039 0-25.42 11.38-25.42 25.419 0 14.038 11.381 25.418 25.42 25.418zm256.05 0c14.039 0 25.419-11.38 25.419-25.418 0-14.039-11.38-25.419-25.419-25.419-14.038 0-25.418 11.38-25.418 25.419 0 14.038 11.38 25.418 25.418 25.418zm-190.632 55.475c0 14.038-11.38 25.419-25.418 25.419-14.039 0-25.42-11.381-25.42-25.419s11.381-25.419 25.42-25.419c14.038 0 25.418 11.381 25.418 25.419zm176.051 0c0 14.038-11.38 25.419-25.419 25.419-14.038 0-25.418-11.381-25.418-25.419s11.38-25.419 25.418-25.419c14.039 0 25.419 11.381 25.419 25.419zM201 342.453c14.038 0 25.419-11.381 25.419-25.419S215.038 291.615 201 291.615s-25.419 11.381-25.419 25.419 11.381 25.419 25.419 25.419z",fill:"currentColor"}))}function We(){const e=C({gutter:2});return i.createElement(i.Fragment,null,i.createElement(S,t(t({},e),{className:p`bg-#252423 p-1 border border-#454443`}),i.createElement(l,null,(()=>i.createElement(i.Fragment,null,F.status)))),i.createElement(M,t(t({},e),{"aria-label":"MIDI output settings",className:p`bg-#090807 border border-#8b8685 p-1`}),i.createElement(l,null,(()=>{const n=F.outputs;return i.createElement(i.Fragment,null,n.map((n=>i.createElement(T,t(t({key:n.key},e),{className:p`block w-full focus:bg-#454443 text-left p-1`,onClick:()=>{return t=n.key,B(t),void e.hide();var t}}),n.name))))}))))}const je=s({updateNeeded:null}),Pe=a("registerUpdate",(e=>{je.updateNeeded={reload:e}}));function Ve(e){return i.createElement(l,null,(()=>i.createElement(i.Fragment,null,e.children(je.updateNeeded))))}class $e extends i.Component{constructor(e){super(e),this.enterFullScreen=()=>{var e=document.getElementById("main");e&&(e.requestFullscreen?(e.requestFullscreen(),this.setState({isFullscreen:!0})):e.webkitRequestFullscreen?(e.webkitRequestFullscreen(),this.setState({isFullscreen:!0})):e.msRequestFullscreen&&(e.msRequestFullscreen(),this.setState({isFullscreen:!0})))},this.exitFullScreen=()=>{const e=document;e.exitFullscreen?(e.exitFullscreen(),this.setState({isFullscreen:!1})):e.webkitExitFullscreen?(e.webkitExitFullscreen(),this.setState({isFullscreen:!1})):e.msExitFullscreen&&(e.msExitFullscreen(),this.setState({isFullscreen:!1}))},this.state={isFullscreen:!1}}render(){const{isFullscreen:e}=this.state;return console.log("isFullscreen: ",e),e?i.createElement(x,{onClick:this.exitFullScreen},"Exit Fullscreen"):i.createElement(x,{onClick:this.enterFullScreen},"Enter Fullscreen")}}function Ue({features:e}){return i.createElement(I,null,i.createElement(Fe,{features:e},i.createElement(Le,{features:e},i.createElement("div",{className:p`absolute inset-0 overflow-hidden leading-tight`},i.createElement("header",{className:p`absolute top-0 inset-x-0 h-[40px] bg-#090807 border-b border-#454443 z-10 flex items-center`},i.createElement("h1",{className:p`text-#8b8685 font-bold ml-2`},i.createElement(Ve,null,(e=>e?i.createElement("button",{className:p`cursor-pointer text-yellow-300`,onClick:()=>e.reload()},"New version available — click to update"):i.createElement(i.Fragment,null,"WebMIDICon")))),i.createElement("aside",{className:p`absolute inset-y-0 right-2 flex`},i.createElement(i.Fragment,null,i.createElement($e,null),i.createElement(Re,null)))),i.createElement("section",{className:p`absolute top-[40px] inset-x-0 bottom-0`},i.createElement(qe,{features:e}))))))}function qe(e){const t=function(){const e=i.useContext(Be);if(!e)throw new Error("No store provided");return e}();return i.createElement(ke,{features:e.features,store:t})}const He=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"];function Ge(e){e.preventDefault(),e.stopPropagation()}class Xe extends i.PureComponent{render(){const e=this.props.store;return i.createElement(ne,null,i.createElement("div",{className:"BeginnerChordMachine",style:{left:0,top:0,bottom:0,right:0,position:"absolute"}},i.createElement("div",{style:{left:"50%",top:"50%",position:"absolute"}},i.createElement(Qe,{store:e}),i.createElement(et,{store:e,v:[0,16,19],n:1,x:-2,y:1,text:"I",fn:"tonic",q:""}),i.createElement(et,{store:e,v:[2,17,21],n:2,x:0,y:1,text:"ii",fn:"subdominant",q:"m"}),i.createElement(et,{store:e,v:[4,19,23],n:3,x:2,y:1,text:"iii",fn:"tonic",q:"m"}),i.createElement(et,{store:e,v:[5,12,21],n:4,x:-3,y:-1,text:"IV",fn:"subdominant"}),i.createElement(et,{store:e,v:[7,14,23],n:5,x:-1,y:-1,text:"V",fn:"dominant"}),i.createElement(et,{store:e,v:[9,16,24],n:6,x:1,y:-1,text:"vi",fn:"tonic",q:"m"}),i.createElement(et,{store:e,v:[-1,14,17],n:7,x:3,y:-1,text:"vii°",fn:"dominant",q:"dim"}))))}}const Ye=u("div")`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  box-sizing: border-box;
  border: 3px solid #8b8685;
  border-radius: 100%;
`,Je=u("div")`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  pointer-events: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
`,Ze=u("div")`
  position: absolute;
  top: -220px;
  left: -200px;
  width: 400px;
  text-align: center;
  color: #8b8685;
`,Qe=N((function(e){const{store:t}=e,n=[He[(144+t.transpose)%12]," major · ",He[(144+t.transpose+9)%12]," minor"].join("");return i.createElement(Ze,null,i.createElement("strong",null,"Key:")," ",n)})),et=N(class extends i.PureComponent{constructor(){super(...arguments),n(this,"state",{active:!1}),n(this,"onTouchStart",(e=>{Ge(e),this.props.store.handleTouches([...this.props.v]),this.setState({active:!0})})),n(this,"onTouchEnd",(e=>{Ge(e),this.props.store.handleTouches([]),this.setState({active:!1})}))}render(){const e=this.props.store.transpose+this.props.v[0],t=He[(144+e)%12],n=160,o=96*this.props.x,r=96*this.props.y*Math.sin(Math.PI/3),s="dominant"===this.props.fn?0:"subdominant"===this.props.fn?240:120;return i.createElement("div",{style:{position:"absolute",left:o-80,top:r-80,width:n,height:n}},i.createElement(Ye,{onTouchStart:this.onTouchStart,onTouchEnd:this.onTouchEnd,style:{borderColor:`hsl(${e%12*30},50%,72%)`}}),i.createElement(Je,null,i.createElement("div",{style:{fontSize:32,color:`hsl(${s},50%,72%)`}},this.props.text),i.createElement("div",{style:{color:"#8b8685",marginTop:5}},t,this.props.q)),i.createElement(Ye,{style:{borderColor:"white",background:`hsl(${e%12*30},50%,72%)`,pointerEvents:"none",opacity:this.state.active?1:0}}))}});var tt={name:"beginner-chord-machine",category:"instruments",description:"A simple instrument that lets you play common chords by tapping on the desired chord button.",instruments:[{id:"beginner",sortKey:"501_beginner",name:"Beginner chord machine",description:"A simple instrument that lets you play common chords.",component:Xe}]},nt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:tt});class ot extends i.PureComponent{render(){return i.createElement("div",{style:{position:"absolute",top:0,right:0,bottom:0,left:0}},i.createElement("div",{style:{position:"absolute",top:2,right:2,bottom:2,left:2}},i.createElement(ce,null,(e=>e.map(((e,t)=>this.renderButton(e,t)))))))}renderButton(e,t){const n=25*Math.floor(t/4)+"%",o=t%4*25+"%",r=`hsl(${15*e.note}, 20%, 30%)`,s=`hsl(${15*e.note}, 40%, 90%)`;return i.createElement("div",{style:{position:"absolute",top:n,left:o,width:"25%",height:"25%"},key:`renderButton${t}`},i.createElement(rt,{background:r,backgroundActive:s,name:e.name,onTrigger:t=>this.props.onTrigger(e.note,t)}))}}const rt=class extends i.PureComponent{constructor(e){super(e),n(this,"registerTouchElement",(e=>{this.element=e})),n(this,"registerActiveElement",(e=>{this.activeElement=e,e&&(e.style.opacity="0")})),n(this,"onContextMenu",(e=>{e.preventDefault()})),n(this,"handleTouchStart",(e=>{if(!this.element)return;const t=e.changedTouches[0];if(!t)return;const n=this.element.getBoundingClientRect(),o=(t.clientX-n.left)/n.width,r=(t.clientY-n.top)/n.height,s=1-2*(Math.pow(o-.5,2)+Math.pow(r-.5,2));if(this.props.onTrigger(s),!this.activeElement)return;const a=++this.touchId;this.activeElement.style.opacity=s,setTimeout((()=>{a===this.touchId&&this.activeElement&&(this.activeElement.style.opacity="0")}),25)})),this.touchId=0}render(){const{background:e,backgroundActive:t,name:n}=this.props;return i.createElement(ne,null,i.createElement("div",{onTouchStart:this.handleTouchStart,onContextMenu:this.onContextMenu,style:{position:"absolute",top:0,right:0,bottom:0,left:0,transform:"translateZ(0)",MozUserSelect:"none",KhtmlUserSelect:"none",WebkitUserSelect:"none",userSelect:"none"},ref:this.registerTouchElement},i.createElement("div",{style:{position:"absolute",top:2,right:2,bottom:2,left:2,background:e,transform:"translateZ(0)"}}),i.createElement("div",{ref:this.registerActiveElement,style:{position:"absolute",top:1,right:1,bottom:1,left:1,background:t,transform:"translateZ(0)"}}),i.createElement("div",{style:{position:"absolute",top:0,right:0,bottom:0,left:0,display:"flex",alignItems:"center",justifyContent:"center",transform:"translateZ(0)"}},i.createElement("div",{style:{fontSize:"3vw",textAlign:"center"}},n))))}};var st={name:"drum-pad",category:"instruments",description:"A touchscreen drum pad with variable velocity. Touching nearer the center produces louder hits.",instruments:[{id:"drums",sortKey:"201_drums",name:"Drum pad",description:"A drum pad with variable velocity. Touching nearer the center produces louder hits.",component:function(){const e=ae("midi.output.channel"),t=ae("drumPad.midiChannelOverride");return i.createElement(ot,{onTrigger:(n,o)=>{const r=Math.max(0,Math.min(127,Math.round(127*o))),s=+t.value||+e.value||10;j([144+s-1,n,r]),j([128+s-1,n,r])}})}}],configuration:{title:"Drum Pad",properties:{"drumPad.midiChannelOverride":{type:"string",default:"10",markdownDescription:"Overrides the MIDI channel for outputting drum notes."},"drumPad.buttonOverride":{type:"string",default:"",markdownDescription:"Overrides the button. Syntax: “i=n,text;” Example: “5=36,Kick;”"}}}},at=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:st});const it=u("div")`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  box-sizing: border-box;
  border: 3px solid #8b8685;
  border-radius: 100%;
`,lt={jammer:(e,t)=>{const n=Math.sqrt(e*e+t*t)/14,o=.5*n,r=n/2,s=n*Math.sqrt(3);return{keySize:o,x:e=>n/2+e*r,y:(e,o)=>t-n/2+(e/2-o)*s,note:(e,t)=>-5*e+12*t}},bcba:(e,t)=>{const n=t/4.33,o=.5*n,r=n/2,s=n*Math.sqrt(3);return{keySize:o,x:e=>n/2+e*r,y:(e,o)=>t-n/2+(e/2-o)*s,note:(e,t)=>1*e+1*t+7}},ccba:(e,t)=>{const n=t/4.33,o=.5*n,r=n/2,s=n*Math.sqrt(3);return{keySize:o,x:e=>n/2+e*r,y:(e,o)=>t-n/2+(e/2-o)*s,note:(e,t)=>2*e+-1*t}},harmonic:(e,t)=>{const n=Math.sqrt(e*e+t*t)/14,o=.5*n,r=n*Math.sqrt(3)/2,s=n;return{keySize:o,x:e=>n/2+e*r,y:(e,o)=>t-n/2+(e/2-o)*s,note:(e,t)=>7*t-3*e}}},ct={keys:[],keySize:0};function ut(e,t,n){if(!t||!n)return ct;const o=lt[e];if(!o)return ct;const{x:r,y:s,note:a,keySize:i}=o(t,n),l=[];for(let c=0;r(c)<=t;c++)for(let e=0;s(c,e)>=0;e++){const t=r(c),o=s(c,e),i=a(c,e);t<0||(o>n||l.push({key:`${c}:${e}`,x:t,y:o,noteValue:i}))}return{keys:l,keySize:i}}class dt extends i.Component{constructor(e){super(e),n(this,"handleContainerRef",(e=>{this.container=e})),n(this,"handleSizeChange",(()=>{this.container&&this.setState({width:this.container.offsetWidth,height:this.container.offsetHeight})})),n(this,"selectKeys",K((({props:e})=>e.type),(({state:e})=>e.width),(({state:e})=>e.height),ut)),n(this,"selectKeyElements",K(this.selectKeys,(({props:e})=>e.store),(({keys:e,keySize:t},n)=>e.map((e=>i.createElement(mt,{"data-key":e.key,store:n,key:e.key,size:t,noteValue:e.noteValue,left:e.x,top:e.y})))))),n(this,"getSelectorState",(()=>({props:this.props,state:this.state}))),n(this,"renderKeys",(()=>this.selectKeyElements(this.getSelectorState()))),n(this,"updateTouches",(e=>{e.preventDefault();const t=this.container;if(!t)return;const n=t.getBoundingClientRect(),o=n.left,r=n.top,s=new Set,{keys:a}=this.selectKeys(this.getSelectorState());[].forEach.call(e.touches,(e=>{const t=a.map((({noteValue:t,x:n,y:s})=>({noteValue:t,distance:Math.sqrt(Math.pow(e.clientX-(o+n),2)+Math.pow(e.clientY-(r+s),2))}))).sort(((e,t)=>e.distance-t.distance));s.add(t[0].noteValue)})),this.props.store.handleTouches([...s])})),this.keys=[],this.state={keyElements:null}}componentDidMount(){window.requestAnimationFrame((()=>{this.handleSizeChange()})),window.addEventListener("resize",this.handleSizeChange)}UNSAFE_componentWillUnmount(){window.removeEventListener("resize",this.handleSizeChange)}render(){return i.createElement(ne,null,i.createElement("div",{ref:this.handleContainerRef,onTouchStart:this.updateTouches,onTouchMove:this.updateTouches,onTouchEnd:this.updateTouches,style:{position:"absolute",overflow:"hidden",top:0,right:0,bottom:0,left:0}},this.renderKeys()))}}const mt=N(class extends i.Component{constructor(e){super(e),this.isTouched=D((()=>this.props.store.activeNotes.has(this.props.noteValue)))}render(){const{size:e,noteValue:t,left:n,top:o}=this.props,r=this.props.store.transpose+t;return i.createElement("div",{"data-key":this.props["data-key"],style:{position:"absolute",left:n-e/2,top:o-e/2,width:e,height:e}},i.createElement(it,{style:{borderColor:`hsl(${r%12*30},50%,72%)`}}),i.createElement(it,{className:"is-active",style:{borderColor:"white",background:`hsl(${r%12*30},50%,72%)`,opacity:this.isTouched.get()?1:0}}))}});var pt={name:"isomorphic-keyboard",category:"instruments",description:"An isomorphic keyboard where each button has an consistent interval with adjacent keys. To learn more, see [Isomorphic keyboards](http://www.altkeyboards.com/instruments/isomorphic-keyboards).",instruments:[{id:"jammer",sortKey:"301_jammer",name:"Jammer",description:"A isomorphic keyboard with the Jammer (Wicki-Hayden) key layout.",component:({store:e})=>i.createElement(dt,{type:"jammer",store:e})},{id:"sonome",sortKey:"302_sonome",name:"Sonome",description:"A isomorphic keyboard with the Sonome (harmonic table) key layout.",component:({store:e})=>i.createElement(dt,{type:"harmonic",store:e})},{id:"ccba",sortKey:"303_ccba",name:"C-System",description:"A isomorphic keyboard with the C-System Chromatic Button Accordian layout.",component:({store:e})=>i.createElement(dt,{type:"ccba",store:e})},{id:"bcba",sortKey:"303_bcba",name:"B-System",description:"A isomorphic keyboard with the B-System Chromatic Button Accordian layout.",component:({store:e})=>i.createElement(dt,{type:"bcba",store:e})}]},ht=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:pt});const ft=u("div")`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
`,yt=u("div")`
  position: absolute;
  top: 0;
  bottom: 0;
`,bt=u("div")`
  & .white {
    position: absolute;
    background: #8b8685;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    border: 2px solid #b9b8b7;
    border-bottom-color: #090807;
    border-right-color: #090807;
    z-index: 1;
  }

  & .black {
    position: absolute;
    background: #252423;
    top: 0;
    bottom: 50%;
    left: 60%;
    width: 80%;
    border: 2px solid #b9b8b7;
    border-bottom-color: #090807;
    border-right-color: #090807;
    z-index: 2;
  }

  & .black.is-active,
  & .white.is-active {
    pointer-events: none;
    border-color: white black black white;
  }
`;class gt extends i.PureComponent{constructor(e){super(e),n(this,"handleTouch",(e=>{const t=new Set;[].forEach.call(e.touches,(e=>{const n=document.elementFromPoint(e.clientX,e.clientY),o=this.keyMap.get(n);null!=o&&t.add(o)})),this.props.store.handleTouches([...t])})),this.keys={},this.keyMap=new WeakMap}render(){return i.createElement(ne,null,i.createElement(ft,{onTouchStart:this.handleTouch,onTouchMove:this.handleTouch,onTouchEnd:this.handleTouch,className:"PianoKeyboard"},this.renderRow(0,24),this.renderRow(1,12),this.renderRow(2,0)))}renderRow(e,t){const n=.04;return i.createElement("div",{style:{position:"absolute",top:wt(n+e/3*.96),right:"3%",height:wt(.28),left:"3%"}},i.createElement(vt,{keyShift:t,store:this.props.store,refKey:(t,n)=>{this.handleKeyRef(t,e,n)}}))}handleKeyRef(e,t,n){(this.keys[e]||(this.keys[e]={}))[t]=n,n&&this.keyMap.set(n,e)}}class vt extends i.Component{render(){return i.createElement("div",null,this.renderKeySet(0,5,!0),this.renderKeySet(1,7,!0),this.renderKeySet(2,9,!0),this.renderKeySet(3,11,!1),this.renderKeySet(4,12,!0),this.renderKeySet(5,14,!0),this.renderKeySet(6,16,!1),this.renderKeySet(7,17,!0),this.renderKeySet(8,19,!0),this.renderKeySet(9,21,!0),this.renderKeySet(10,23,!1),this.renderKeySet(11,24,!0),this.renderKeySet(12,26,!0),this.renderKeySet(13,28,!1))}renderKeySet(e,t,n){const o=t+this.props.keyShift,r=o+1;return i.createElement(yt,{style:{left:wt(e/14),width:wt(1/14)}},this.renderKey("white",o),n&&this.renderKey("black",r))}renderKey(e,t){return i.createElement(Et,{store:this.props.store,keyColor:e,noteValue:t,refKey:e=>this.props.refKey(t,e)})}}const Et=N(class extends i.Component{constructor(e){super(e),this.isTouched=D((()=>this.props.store.activeNotes.has(this.props.noteValue)))}render(){const e=this.isTouched.get(),t=this.props.store.transpose+this.props.noteValue;return i.createElement(bt,null,i.createElement("div",{className:this.props.keyColor,ref:this.props.refKey}),i.createElement("div",{className:this.props.keyColor+" is-active",style:{opacity:e?1:0,background:`hsl(${t%12*30},100%,90%)`,transition:e?"":"0.3s opacity"}}))}});function wt(e){return(100*e).toFixed(6)+"%"}var kt={name:"piano-keyboard",category:"instruments",description:"A touchscreen piano keyboard.",instruments:[{id:"piano",sortKey:"101_piano",name:"Piano",description:"A piano keyboard.",component:gt}]},xt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:kt});const Ct=s({keyCodes:s.map({})});function St(e){return 124===e.keyCode?45:(2===e.location?1e3:3===e.location?2e3:0)+e.keyCode}let Mt=1,Tt=!1,It=null;var Nt={name:"midi-keybindings",category:"addons",description:"Play notes with your QWERTY keyboard. Supports 3 octaves. Use Left/Right to transpose, Up/Down to change octave, Space to hold the pedal, and Esc-F12 to set a key.",onKeyDown(e,t){const n=St(t);{const t=Kt.indexOf(n);if(t>-1)return void e.setTranspose(t-6)}if(32===n){const e=Mt;return j([176+e-1,64,127]),void(It={up:()=>{j([176+e-1,64,0])}})}37!==n?38!==n?39!==n?40!==n?Ct.keyCodes.set(n,{altKey:t.altKey}):e.setOctave(e.octave-1):e.setTranspose(e.transpose+1):e.setOctave(e.octave+1):e.setTranspose(e.transpose-1)},onKeyUp(e,t){const n=St(t);if(32===n&&It)return It.up(),void(It=null);Ct.keyCodes.delete(n)},getActiveNotes(){const e=[];if(Tt)for(const[t]of Ct.keyCodes.entries())for(const[n,o]of _t.entries()){const r=o.indexOf(+t);r>-1&&e.push(n+3*r+4)}else for(const[t,{altKey:n}]of Ct.keyCodes.entries()){{const n=Dt.indexOf(+t);n>-1&&e.push(n+11)}{const o=Ot.indexOf(+t);o>-1&&e.push(o+22+(n?12:0))}}return e},configuration:{title:"MIDI Keybindings",properties:{"midiKeybindings.keymap":{type:"string",default:"piano",markdownDescription:"Whether to use the Piano keymap or B-System Chromatic Button Accordian keymap.",enum:["piano","bcba"]}}},serviceComponent:function(){const e=ae("midi.output.channel"),t=ae("midiKeybindings.keymap");return i.useEffect((()=>{Mt=+e.value||1}),[e.value]),i.useEffect((()=>{Tt="bcba"===t.value}),[t.value]),null}};const Kt=[27,112,113,114,115,116,117,118,119,120,121,122,123],Dt=[16,90,83,88,68,67,86,71,66,72,78,74,77,188,76,190,186,191,1016],Ot=[192,9,81,50,87,51,69,82,53,84,54,89,55,85,73,57,79,48,80,219,187,221,8,220,45,46,35,36,34,33,2055,2056,2111,2057,2106,2107,2109],_t=[[192,49,50,51,52,53,54,55,56,57,48,189,187,8],[9,81,87,69,82,84,89,85,73,79,80,219,221,220],[17,65,83,68,70,71,72,74,75,76,186,222],[16,90,88,67,86,66,78,77,188,190,191,1016]];var Ft=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Nt});class Bt extends i.PureComponent{constructor(){super(...arguments),n(this,"handleTouch",(e=>{const t=e.touches.length,n=Math.pow(t/11,1/3);this.div&&(this.div.style.opacity=n),!this._on&&t>=1&&(j([176,64,127]),this._on=!0),this._on&&t<1&&(j([176,64,0]),this._on=!1),e.preventDefault()}))}render(){return i.createElement(ne,null,i.createElement("div",{onTouchStart:this.handleTouch,onTouchMove:this.handleTouch,onTouchEnd:this.handleTouch,style:{position:"absolute",top:0,right:0,bottom:0,left:0}},i.createElement("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",fontSize:"20vw",fontWeight:"bold",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif'}},"iPedal"),i.createElement("div",{style:{position:"absolute",top:0,right:0,bottom:0,left:0,background:"white"},ref:e=>{this.div=e}})))}}var Lt={name:"touch-pedal",category:"instruments",description:"A touchscreen-activated pedal.",instruments:[{id:"pedal",sortKey:"401_pedal",name:"iPedal",description:"A touchscreen-activated pedal.",component:Bt}]},Rt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Lt}),At={name:"joypedal",category:"addons",description:"Press button 10 or 11 on any connected gamepad to activate the pedal. These buttons correspond to the analog buttons on a DualShock controller.",configuration:{title:"Joypedal",properties:{"joypedal.buttons":{type:"string",default:"10,11",markdownDescription:"Comma-separated list of gamepad button numbers to be detected. The pedal will be considered “pressed” when _any_ of these buttons are pressed. Use [gamepad-tester.com](https://gamepad-tester.com/) to find out the button."},"joypedal.mode":{type:"string",default:"sustain",markdownDescription:"Whether to use Joypedal as a sustain pedal or as a kick drum.",enum:["sustain","kick"]},"joypedal.kick.midiChannelOverride":{type:"string",default:"10",markdownDescription:"Override the MIDI channel used for the kick drum."}}},serviceComponent:function(){const e=ae("midi.output.channel"),t=ae("joypedal.buttons"),n=ae("joypedal.mode"),o=ae("joypedal.kick.midiChannelOverride"),r={buttons:t,mode:n,kickChannel:o,mainChannel:e},s=i.useRef(r);return i.useEffect((()=>{s.current=r}),[r]),i.useEffect((()=>function(e){let t=null;function n(){let n=!1;for(const t of navigator.getGamepads())if(t)for(const o of e.getButtons())t.buttons[o]&&t.buttons[o].pressed&&(n=!0);if(!t&&n)switch(e.getMode()){case"kick":{const n=e.getKickChannel()||10;j([144+n-1,36,127]),j([128+n-1,36,127]),t={up:()=>{}};break}case"sustain":{const n=e.getMainChannel()||1;j([176+n-1,64,127]),t={up:()=>{j([176+n-1,64,0])}};break}default:console.warn("Joypedal: Invalid mode.")}else if(t&&!n)try{t.up()}finally{t=null}}const o=setInterval(n,16);return()=>{clearInterval(o)}}({getButtons:()=>s.current.buttons.value.split(",").map((e=>+e)),getMainChannel:()=>+s.current.mainChannel.value,getKickChannel:()=>+s.current.kickChannel.value,getMode:()=>s.current.mode.value})),[]),null}};var zt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:At});let Wt;const jt={};var Pt={name:"chord-identifier",category:"addons",description:"Identify chords",instruments:[],serviceComponent:function(e){const[t,n]=i.useState(void 0);return i.useEffect((()=>{(function(e,t){if(!t)return e();if(void 0===Wt){const e=document.createElement("link").relList;Wt=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if(e in jt)return;jt[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":Wt,t||(o.as="script",o.crossOrigin=""),o.href=e,document.head.appendChild(o),t?new Promise(((e,t)=>{o.addEventListener("load",e),o.addEventListener("error",t)})):void 0}))).then((()=>e()))})((()=>__import__("./sharp11.d4ee5a99.js").then((function(e){return e.s}))),["/WebMIDICon/assets/sharp11.d4ee5a99.js","/WebMIDICon/assets/vendor.a875edc9.js"]).then((e=>{n(e)}))}),[]),i.createElement(l,null,(()=>i.createElement(Vt,{activeNotes:[...e.store.activeNotes].map((t=>t+e.store.transpose)).sort(((e,t)=>e-t)),sharp11:t})))}};function Vt(e){const t=function(e){const t=i.useRef(e);if(e!==t.current)if(e.length!==t.current.length)t.current=e;else for(let n=0;n<e.length;n++)if(t.current[n]!==e[n]){t.current=e;break}return t.current}(e.activeNotes),n=e.sharp11,o=i.useMemo((()=>t.length>2?null==n?void 0:n.chord.identifyArray(e.activeNotes.map((e=>n.note.fromValue(e+24)))):null),[t,n]);return i.useEffect((()=>{}),[o]),o?i.createElement(ge,{id:"chord"},o):null}var $t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Pt});const Ut=e=>Math.max(0,Math.min(16383,Math.round(e)));var qt={name:"gyro-controller",category:"instruments",description:"Use gyroscope to send MIDI control message.",instruments:[{id:"gyrocon",sortKey:"402_gyrocon",name:"Gyrocon",description:"A gyroscope-activated controller. Right now it only does pitch bending.",component:function(){const[e,t]=i.useState("..."),[n,o]=i.useState(8192),r=i.useRef(n),s=i.useRef(null),[a,l]=i.useState(!1),c=i.useRef(a);return i.useEffect((()=>{j([224,127&n,n>>7]),r.current=n}),[n]),i.useEffect((()=>{if(c.current=a,!a){const e=setInterval((()=>{document.pointerLockElement&&o((e=>Ut(.9*(e-8192)+8192)))}));return()=>clearInterval(e)}}),[a]),i.useEffect((()=>{j([176,101,0]),j([176,100,0]),j([176,6,2]),j([176,38,0]);const e=e=>{const n=e.beta||0,r=2.5,s=n>r?n-r:n<-2.5?n+r:0,a=8192+Math.round(8191*Math.max(-1,Math.min(1,s/-10)));t(`${n.toFixed(2)}`),o(a)};return window.addEventListener("deviceorientation",e),()=>{window.removeEventListener("deviceorientation",e)}}),[]),i.useMemo((()=>{const t=(n-8192)/8192*-50+50;return i.createElement("div",{className:p`absolute inset-0 overflow-hidden`},i.createElement("div",{className:p`absolute inset-0`,style:{transform:`translate3d(0, ${t}%, 0)`},ref:s,onMouseDown:e=>{l(!0)},onMouseMove:e=>{document.pointerLockElement&&c.current&&o((t=>Ut(t+-100*e.movementY)))},onMouseUp:e=>{l(!1)},onDoubleClick:()=>{var e;return null==(e=s.current)?void 0:e.requestPointerLock()}},i.createElement("div",{className:p`flex items-center justify-center inset-x-0 top-0 h-[64px] bg-#090807`,style:{transform:`translate3d(0, ${-t}%, 0)`}},i.createElement("div",{className:p`text-3xl pre-wrap`},e))))}),[e,n])}}]};const Ht=[nt,at,ht,xt,Ft,Rt,zt,$t,Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:qt})];O({theme:{fontFamily:{sans:["Arimo","Helvetica","sans-serif"]},extend:{colors:{"#e9e8e7":"#e9e8e7","#8b8685":"#8b8685","#656463":"#656463","#454443":"#454443","#353433":"#353433","#252423":"#252423","#090807":"#090807","#bbeeff":"#bbeeff","#d7fc70":"#d7fc70","#ffffbb":"#ffffbb"}}}});const Gt=function(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:s}=e;let a,i;if("serviceWorker"in navigator){a=new o("/WebMIDICon/sw.js",{scope:"/WebMIDICon/"}),a.addEventListener("activated",(e=>{e.isUpdate||null==s||s()}));{const e=()=>{null==n||n()};a.addEventListener("waiting",e),a.addEventListener("externalwaiting",e)}a.register({immediate:t}).then((e=>i=e))}return async(e=!0)=>{e&&(null==a||a.addEventListener("controlling",(e=>{e.isUpdate&&window.location.reload()}))),i&&i.waiting&&await r(i.waiting,{type:"SKIP_WAITING"})}}({onNeedRefresh(){Pe((()=>Gt(!0)))},onOfflineReady(){console.log("Offline ready")}}),Xt=(()=>{const e=document.getElementById("main");if(e)return e;const t=document.createElement("div");return t.id="main",document.body.appendChild(t),t})(),Yt=Ht.map((e=>e.default));_.render(i.createElement(Ue,{features:Yt}),Xt);
